<?xml version="1.0" encoding="UTF-8"?>
<!--
  W3C SCXML Test 513: BasicHTTP Event I/O Processor Success Response

  Tests that SCXML Processor's BasicHTTP Event I/O Processor responds with
  HTTP 200 OK when receiving well-formed events.

  Original test is manual (send HTTP POST to processor's location URL and check 200 OK).
  This SCXML automates the validation by:
  1. W3CTestRunner starts HTTP server infrastructure automatically
  2. External HTTP client sends POST request to processor's location URL
  3. BasicHTTP Event I/O Processor receives request and responds with 200 OK
  4. Event is placed in external queue and state machine transitions to pass

  W3C SCXML C.2 specifies that BasicHTTP Event I/O Processor must:
  - Accept HTTP POST requests at the access URI
  - Respond with 2XX success code for well-formed events
  - Place received events in the external event queue
-->
<scxml xmlns="http://www.w3.org/2005/07/scxml" version="1.0" datamodel="ecmascript" initial="s0">

  <state id="s0">
    <onentry>
      <!-- Set timeout in case HTTP event never arrives -->
      <send event="timeout" delay="30s"/>
      <!-- Send HTTP event to ourselves to validate 200 OK response -->
      <send event="test" target="http://localhost:8080/test" type="http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor"/>
    </onentry>

    <!-- Transition to pass if we receive HTTP event (validates 200 OK response) -->
    <transition event="test" target="pass">
      <log expr="&quot;Test 513: Received HTTP event - server responded with 200 OK&quot;"/>
    </transition>

    <!-- Fail on timeout -->
    <transition event="timeout" target="fail">
      <log expr="&quot;Test 513: Timeout - no HTTP event received&quot;"/>
    </transition>
  </state>

  <final id="pass">
    <onentry>
      <log expr="&quot;Test 513 PASS: BasicHTTP Event I/O Processor success response validated&quot;"/>
    </onentry>
  </final>

  <final id="fail">
    <onentry>
      <log expr="&quot;Test 513 FAIL: BasicHTTP Event I/O Processor did not respond with 200 OK&quot;"/>
    </onentry>
  </final>

</scxml>
