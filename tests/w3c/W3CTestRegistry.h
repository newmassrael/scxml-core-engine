#pragma once

#include <unordered_map>

namespace SCE::W3C {

/**
 * @brief W3C SCXML Test Engine Type
 *
 * Classifies tests by their execution engine requirements.
 */
enum class TestEngine {
    /**
     * AOT (Ahead-of-Time) engine
     * - Pure Static: All features known at compile-time
     * - Static Hybrid: Static structure + JSEngine for ECMAScript expressions
     *
     * Examples:
     * - Pure Static: test144 (basic transitions)
     * - Static Hybrid: test350 (contentexpr invoke)
     */
    AOT,

    /**
     * Interpreter engine (runtime SCXML parsing)
     * Required for tests with:
     * - Dynamic file invoke (srcexpr evaluates to file path)
     * - No initial state (W3C SCXML 3.6 default to first child)
     * - Invalid initial state (validation at runtime)
     * - Parallel initial state (space-separated state IDs)
     *
     * Examples:
     * - test192: inline <content> with dynamic child SCXML
     * - test216: srcexpr (dynamic file path evaluation)
     * - test376: no initial state (runtime default selection)
     */
    INTERPRETER
};

/**
 * @brief W3C SCXML Test Registry
 *
 * Single Source of Truth for test classification.
 * Auto-generated by CMake from test lists in CMakeLists.txt.
 *
 * Architecture Benefits:
 * - CMakeLists.txt is single point of control (W3C_AOT_TESTS, W3C_INTERPRETER_ONLY_TESTS)
 * - Test*.h files maintained per-test (AOT implementation), runners auto-generated by CMake
 * - W3CTestRegistry.cpp auto-generated from CMake template
 * - Easy test migration: Move test number between lists in CMakeLists.txt, re-run cmake
 */
class W3CTestRegistry {
public:
    /**
     * @brief Get execution engine for a test
     *
     * @param testId W3C test ID (e.g., "144", "403a", "192")
     * @return TestEngine::AOT or TestEngine::INTERPRETER
     *
     * If test is not registered, returns TestEngine::INTERPRETER as safe fallback.
     */
    static TestEngine getEngine(const std::string &testId);

    /**
     * @brief Get execution engine for a test (overload for int)
     *
     * @param testNum W3C test number (e.g., 144, 192)
     * @return TestEngine::AOT or TestEngine::INTERPRETER
     */
    static TestEngine getEngine(int testNum);

    /**
     * @brief Check if test uses AOT engine
     *
     * @param testId W3C test ID (string or int)
     * @return true if test registered as AOT, false otherwise
     */
    static bool isAotTest(const std::string &testId);
    static bool isAotTest(int testNum);

    /**
     * @brief Check if test uses Interpreter engine
     *
     * @param testId W3C test ID (string or int)
     * @return true if test registered as Interpreter or not registered, false otherwise
     */
    static bool isInterpreterTest(const std::string &testId);
    static bool isInterpreterTest(int testNum);

private:
    // Auto-generated by CMake from CMakeLists.txt test lists
    static const std::unordered_map<std::string, TestEngine> &getRegistry();
};

}  // namespace SCE::W3C
